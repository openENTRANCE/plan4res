#/bin/bash

# this script launches the simulation and posttreatment 
# it requires to have bellmanvalues available ($INSTANCE/results/BellmanVauesOUT.csv or cuts.txt if sddp did not converge)

export P4R_SINGULARITY_IMAGE_PRESERVE=1 # avoid update of the container
export P4R_ENV="../bin/p4r"
export TIME_P4R_ENV="/usr/bin/time -v ${P4R_ENV}"
export PYTHONSCRIPTS="scripts/python/plan4res-scripts/"
export DATA="data/local/"

# DATASET is the name of the directory within data/local
if [ "$1" == "" ] ; then
    echo "provide name of dataset in data/local/"
    read DATASET
else
	echo $1
	DATASET=$1
	echo $DATASET
fi

export INSTANCE="${DATA}${DATASET}/"
export CONFIG="${DATA}${DATASET}/settings/"

# run formatting script to create netcdf input files
${P4R_ENV} python -W ignore ${PYTHONSCRIPTS}format.py /${CONFIG}settings_format_simul.yml /${CONFIG}settingsCreateInputPlan4res_simul.yml ${DATASET}

